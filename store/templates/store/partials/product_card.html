{% load static image_extras i18n %}
<div class="card shadow-sm h-100 product-card d-flex flex-column position-relative" data-aos="fade-up">
    <a href="{% url 'store:product_detail' product.slug %}">
    <img src="{% product_image product 'card' %}" class="card-img-top" alt="{{ product.name }}" loading="lazy">
    </a>
    <div class="card-body d-flex flex-column flex-grow-1">
        <h5 class="card-title">
            <a href="{% url 'store:product_detail' product.slug %}" class="text-decoration-none stretched-link">{{ product.name }}</a>
        </h5>
    </div>
    <div class="card-footer product-footer d-flex justify-content-between align-items-center mt-auto">
        <span class="price fw-semibold">{{ product.price }} PLN</span>
        {% with avg=product.avg_rating|default:0 count=product.rating_count|default:0 %}
            <span class="small text-muted d-flex align-items-center gap-1">
                {% if count %}
                    {{ avg|floatformat:1 }}/5&nbsp;<i class="bi bi-star-fill text-warning"></i>
                    <small class="ms-1">({{ count }})</small>
                {% else %}
                    <span class="text-muted">â€”</span>
                {% endif %}
            </span>
        {% endwith %}
        <form method="post" action="{% url 'store:cart_add' product.id %}" class="add-to-cart-form">
            {% csrf_token %}
            <input type="hidden" name="quantity" value="1">
            <button type="button" data-product-id="{{ product.id }}" data-add-url="{% url 'store:cart_add' product.id %}" class="btn btn-sm btn-primary add-to-cart-btn">
                <i class="bi bi-cart-plus"></i> {% trans "Dodaj" %}
            </button>
        </form>
    </div>
</div>
<style>
/* Product card tweaks (kept here for template-scoped overrides if needed) */
</style>