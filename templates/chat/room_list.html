{% extends "base.html" %}
{% block title %}Czaty — EcoMarket{% endblock %}
{% block content %}
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>Czaty</h2>
    <a href="{% url 'chat:room_create' %}" class="btn btn-success">Utwórz pokój</a>
  </div>
  {% if rooms %}
    <ul class="list-group">
      {% for r in rooms %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <div class="fw-bold">{{ r.name }}</div>
            {% if r.topic %}<div class="text-muted small">{{ r.topic }}</div>{% endif %}
          </div>
          <a class="btn btn-outline-primary" href="{% url 'chat:room_detail' r.id %}">Wejdź</a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="alert alert-info">Brak pokoi. Utwórz pierwszy!</div>
  {% endif %}

  {% if pending_invites %}
    <hr/>
    <h5>Zaproszenia</h5>
    <ul class="list-group mb-3">
    {% for inv in pending_invites %}
      <li class="list-group-item d-flex align-items-center gap-2">
        <div>
          <div><strong>{{ inv.room.name }}</strong></div>
          <div class="text-muted small">Zaprosił: {{ inv.inviter.username }}</div>
        </div>
        <form method="post" action="{% url 'chat:accept_invite' inv.id %}" class="ms-auto">
          {% csrf_token %}
          <button class="btn btn-sm btn-primary">Akceptuj</button>
        </form>
        <form method="post" action="{% url 'chat:decline_invite' inv.id %}">
          {% csrf_token %}
          <button class="btn btn-sm btn-outline-secondary">Odrzuć</button>
        </form>
      </li>
    {% endfor %}
    </ul>
  {% endif %}
</div>
{% endblock %}
